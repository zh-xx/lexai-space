<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设置系统测试 - 法律AI工作台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #5A67D8;
            --primary-hover: #4C51BF;
            --secondary-color: #F7FAFC;
            --border-color: #E2E8F0;
            --text-color: #2D3748;
            --text-secondary: #718096;
            --success-color: #48BB78;
            --warning-color: #ED8936;
            --error-color: #F56565;
            --font-sans: 'Inter', 'Noto Sans SC', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: #f8f9fa;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1em;
        }

        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 20px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            background: #fafbfc;
        }

        .test-card h3 {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 12px;
        }

        .test-card p {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-secondary {
            background: #E2E8F0;
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: #CBD5E0;
        }

        .result-area {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: var(--success-color);
        }

        .status-warning {
            background: var(--warning-color);
        }

        .status-error {
            background: var(--error-color);
        }

        .status-neutral {
            background: #CBD5E0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 页面头部 -->
        <div class="header">
            <h1>设置系统测试</h1>
            <p>测试工作流设置和LLM设置的功能</p>
        </div>

        <!-- 工作流设置测试 -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-diagram-project"></i>
                工作流设置测试
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>工作流设置页面</h3>
                    <p>测试工作流设置页面的功能</p>
                    <button class="btn btn-primary" onclick="openWorkflowSettings()">
                        <i class="fa-solid fa-external-link-alt"></i> 打开工作流设置
                    </button>
                    <button class="btn btn-secondary" onclick="testWorkflowSettings()">
                        <i class="fa-solid fa-vial"></i> 测试工作流设置
                    </button>
                </div>

                <div class="test-card">
                    <h3>工作流配置</h3>
                    <p>测试工作流配置的保存和加载</p>
                    <button class="btn btn-primary" onclick="testWorkflowConfig()">
                        <i class="fa-solid fa-cog"></i> 测试配置
                    </button>
                    <button class="btn btn-secondary" onclick="clearWorkflowConfig()">
                        <i class="fa-solid fa-trash"></i> 清除配置
                    </button>
                </div>
            </div>

            <div id="workflow-result" class="result-area" style="display: none;"></div>
        </div>

        <!-- LLM设置测试 -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-brain"></i>
                LLM设置测试
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>LLM设置页面</h3>
                    <p>测试LLM设置页面的功能</p>
                    <button class="btn btn-primary" onclick="openLLMSettings()">
                        <i class="fa-solid fa-external-link-alt"></i> 打开LLM设置
                    </button>
                    <button class="btn btn-secondary" onclick="testLLMSettings()">
                        <i class="fa-solid fa-vial"></i> 测试LLM设置
                    </button>
                </div>

                <div class="test-card">
                    <h3>LLM配置</h3>
                    <p>测试LLM配置的保存和加载</p>
                    <button class="btn btn-primary" onclick="testLLMConfig()">
                        <i class="fa-solid fa-cog"></i> 测试配置
                    </button>
                    <button class="btn btn-secondary" onclick="clearLLMConfig()">
                        <i class="fa-solid fa-trash"></i> 清除配置
                    </button>
                </div>
            </div>

            <div id="llm-result" class="result-area" style="display: none;"></div>
        </div>

        <!-- 设置同步测试 -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-sync"></i>
                设置同步测试
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>消息传递</h3>
                    <p>测试设置页面与工具之间的消息传递</p>
                    <button class="btn btn-primary" onclick="testMessagePassing()">
                        <i class="fa-solid fa-comment"></i> 测试消息传递
                    </button>
                    <button class="btn btn-secondary" onclick="simulateSettingsUpdate()">
                        <i class="fa-solid fa-bell"></i> 模拟设置更新
                    </button>
                </div>

                <div class="test-card">
                    <h3>设置状态</h3>
                    <p>查看当前所有设置的状态</p>
                    <button class="btn btn-primary" onclick="showSettingsStatus()">
                        <i class="fa-solid fa-info-circle"></i> 显示状态
                    </button>
                    <button class="btn btn-secondary" onclick="exportSettings()">
                        <i class="fa-solid fa-download"></i> 导出设置
                    </button>
                </div>
            </div>

            <div id="sync-result" class="result-area" style="display: none;"></div>
        </div>

        <!-- 工具集成测试 -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-tools"></i>
                工具集成测试
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>工具页面</h3>
                    <p>测试各个工具页面的设置集成</p>
                    <button class="btn btn-primary" onclick="openContractParse()">
                        <i class="fa-solid fa-file-contract"></i> 合同解析
                    </button>
                    <button class="btn btn-primary" onclick="openContractReview()">
                        <i class="fa-solid fa-search"></i> 合同审核
                    </button>
                    <button class="btn btn-primary" onclick="openDocumentGen()">
                        <i class="fa-solid fa-file-alt"></i> 合同生成
                    </button>
                </div>

                <div class="test-card">
                    <h3>设置监听</h3>
                    <p>测试工具对设置更新的监听</p>
                    <button class="btn btn-primary" onclick="testSettingsListener()">
                        <i class="fa-solid fa-ear"></i> 测试监听器
                    </button>
                    <button class="btn btn-secondary" onclick="clearSettingsListener()">
                        <i class="fa-solid fa-times"></i> 清除监听器
                    </button>
                </div>
            </div>

            <div id="tools-result" class="result-area" style="display: none;"></div>
        </div>
    </div>

    <script>
        // 测试函数
        function openWorkflowSettings() {
            window.open('tools/workflow-settings.html', '_blank');
            showResult('workflow-result', '✅ 工作流设置页面已打开');
        }

        function openLLMSettings() {
            window.open('tools/llm-settings.html', '_blank');
            showResult('llm-result', '✅ LLM设置页面已打开');
        }

        function testWorkflowSettings() {
            const result = {
                cozeOnlineApiKey: localStorage.getItem('coze_online_api_key') || '未设置',
                cozeLocalUrl: localStorage.getItem('coze_local_base_url') || '未设置',
                reviewWorkflowId: localStorage.getItem('coze_online_review_workflow_id') || '未设置',
                parseWorkflowId: localStorage.getItem('coze_online_parse_workflow_id') || '未设置'
            };
            
            showResult('workflow-result', `📊 工作流设置状态:\n${JSON.stringify(result, null, 2)}`);
        }

        function testLLMSettings() {
            const result = {
                googleApiKey: localStorage.getItem('google_api_key') ? '已设置' : '未设置',
                deepseekApiKey: localStorage.getItem('deepseek_api_key') ? '已设置' : '未设置',
                cozeApiKey: localStorage.getItem('coze_api_key') ? '已设置' : '未设置',
                aiChatModel: localStorage.getItem('ai-chat_model') || '未设置',
                documentGenModel: localStorage.getItem('document-gen_model') || '未设置',
                homepageModel: localStorage.getItem('homepage_model') || '未设置'
            };
            
            showResult('llm-result', `📊 LLM设置状态:\n${JSON.stringify(result, null, 2)}`);
        }

        function testWorkflowConfig() {
            // 模拟设置一些工作流配置
            localStorage.setItem('coze_online_api_key', 'test-coze-api-key');
            localStorage.setItem('coze_local_base_url', 'http://localhost:8080');
            localStorage.setItem('coze_online_review_workflow_id', 'test-review-workflow');
            localStorage.setItem('coze_online_parse_workflow_id', 'test-parse-workflow');
            
            showResult('workflow-result', '✅ 工作流配置已设置测试数据');
        }

        function testLLMConfig() {
            // 模拟设置一些LLM配置
            localStorage.setItem('google_api_key', 'test-google-api-key');
            localStorage.setItem('deepseek_api_key', 'test-deepseek-api-key');
            localStorage.setItem('ai-chat_model', 'gemini-2.5-pro');
            localStorage.setItem('document-gen_model', 'deepseek-chat');
            
            showResult('llm-result', '✅ LLM配置已设置测试数据');
        }

        function clearWorkflowConfig() {
            localStorage.removeItem('coze_online_api_key');
            localStorage.removeItem('coze_local_base_url');
            localStorage.removeItem('coze_online_review_workflow_id');
            localStorage.removeItem('coze_online_parse_workflow_id');
            
            showResult('workflow-result', '🗑️ 工作流配置已清除');
        }

        function clearLLMConfig() {
            localStorage.removeItem('google_api_key');
            localStorage.removeItem('deepseek_api_key');
            localStorage.removeItem('coze_api_key');
            localStorage.removeItem('ai-chat_model');
            localStorage.removeItem('document-gen_model');
            localStorage.removeItem('homepage_model');
            
            showResult('llm-result', '🗑️ LLM配置已清除');
        }

        function testMessagePassing() {
            // 模拟发送设置更新消息
            const testMessage = {
                type: 'workflow_settings_updated',
                data: {
                    cozeOnline: {
                        apiKey: 'test-api-key',
                        reviewWorkflowId: 'test-workflow-id'
                    }
                }
            };
            
            window.postMessage(testMessage, '*');
            showResult('sync-result', '✅ 测试消息已发送');
        }

        function simulateSettingsUpdate() {
            // 模拟设置更新
            const testMessage = {
                type: 'llm_settings_updated',
                data: {
                    apiKeys: {
                        google: 'test-google-key',
                        deepseek: 'test-deepseek-key'
                    },
                    toolModels: {
                        aiChat: 'gemini-2.5-pro',
                        documentGen: 'deepseek-chat'
                    }
                }
            };
            
            window.postMessage(testMessage, '*');
            showResult('sync-result', '✅ 设置更新消息已发送');
        }

        function showSettingsStatus() {
            const status = {
                workflowSettings: {
                    cozeOnline: localStorage.getItem('coze_online_api_key') ? '已配置' : '未配置',
                    cozeLocal: localStorage.getItem('coze_local_base_url') ? '已配置' : '未配置'
                },
                llmSettings: {
                    google: localStorage.getItem('google_api_key') ? '已配置' : '未配置',
                    deepseek: localStorage.getItem('deepseek_api_key') ? '已配置' : '未配置',
                    coze: localStorage.getItem('coze_api_key') ? '已配置' : '未配置'
                },
                toolModels: {
                    aiChat: localStorage.getItem('ai-chat_model') || '未设置',
                    documentGen: localStorage.getItem('document-gen_model') || '未设置',
                    homepage: localStorage.getItem('homepage_model') || '未设置'
                }
            };
            
            showResult('sync-result', `📊 设置状态:\n${JSON.stringify(status, null, 2)}`);
        }

        function exportSettings() {
            const settings = {
                workflow: {
                    cozeOnlineApiKey: localStorage.getItem('coze_online_api_key'),
                    cozeLocalUrl: localStorage.getItem('coze_local_base_url'),
                    reviewWorkflowId: localStorage.getItem('coze_online_review_workflow_id'),
                    parseWorkflowId: localStorage.getItem('coze_online_parse_workflow_id')
                },
                llm: {
                    googleApiKey: localStorage.getItem('google_api_key'),
                    deepseekApiKey: localStorage.getItem('deepseek_api_key'),
                    cozeApiKey: localStorage.getItem('coze_api_key'),
                    aiChatModel: localStorage.getItem('ai-chat_model'),
                    documentGenModel: localStorage.getItem('document-gen_model'),
                    homepageModel: localStorage.getItem('homepage_model')
                }
            };
            
            const dataStr = JSON.stringify(settings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'settings-export.json';
            link.click();
            URL.revokeObjectURL(url);
            
            showResult('sync-result', '💾 设置已导出到 settings-export.json');
        }

        function openContractParse() {
            window.open('tools/contract-parse.html', '_blank');
        }

        function openContractReview() {
            window.open('tools/contract-review.html', '_blank');
        }

        function openDocumentGen() {
            window.open('tools/document-gen.html', '_blank');
        }

        function testSettingsListener() {
            // 添加消息监听器
            window.addEventListener('message', function(event) {
                console.log('收到消息:', event.data);
                showResult('tools-result', `📨 收到消息: ${JSON.stringify(event.data, null, 2)}`);
            });
            
            showResult('tools-result', '✅ 设置监听器已启动，请在其他页面发送消息进行测试');
        }

        function clearSettingsListener() {
            // 清除所有消息监听器
            window.removeEventListener('message', arguments.callee);
            showResult('tools-result', '🗑️ 设置监听器已清除');
        }

        function showResult(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('设置系统测试页面已加载');
            
            // 监听设置更新消息
            window.addEventListener('message', function(event) {
                if (event.data && (event.data.type === 'workflow_settings_updated' || event.data.type === 'llm_settings_updated')) {
                    console.log('测试页面收到设置更新消息:', event.data);
                    showResult('sync-result', `📨 收到设置更新: ${event.data.type}`);
                }
            });
        });
    </script>
</body>
</html> 