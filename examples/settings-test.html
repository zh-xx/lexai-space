<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾ç½®ç³»ç»Ÿæµ‹è¯• - æ³•å¾‹AIå·¥ä½œå°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #5A67D8;
            --primary-hover: #4C51BF;
            --secondary-color: #F7FAFC;
            --border-color: #E2E8F0;
            --text-color: #2D3748;
            --text-secondary: #718096;
            --success-color: #48BB78;
            --warning-color: #ED8936;
            --error-color: #F56565;
            --font-sans: 'Inter', 'Noto Sans SC', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: #f8f9fa;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1em;
        }

        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 20px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            background: #fafbfc;
        }

        .test-card h3 {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 12px;
        }

        .test-card p {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-secondary {
            background: #E2E8F0;
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: #CBD5E0;
        }

        .result-area {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: var(--success-color);
        }

        .status-warning {
            background: var(--warning-color);
        }

        .status-error {
            background: var(--error-color);
        }

        .status-neutral {
            background: #CBD5E0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
            <h1>è®¾ç½®ç³»ç»Ÿæµ‹è¯•</h1>
            <p>æµ‹è¯•å·¥ä½œæµè®¾ç½®å’ŒLLMè®¾ç½®çš„åŠŸèƒ½</p>
        </div>

        <!-- å·¥ä½œæµè®¾ç½®æµ‹è¯• -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-diagram-project"></i>
                å·¥ä½œæµè®¾ç½®æµ‹è¯•
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>å·¥ä½œæµè®¾ç½®é¡µé¢</h3>
                    <p>æµ‹è¯•å·¥ä½œæµè®¾ç½®é¡µé¢çš„åŠŸèƒ½</p>
                    <button class="btn btn-primary" onclick="openWorkflowSettings()">
                        <i class="fa-solid fa-external-link-alt"></i> æ‰“å¼€å·¥ä½œæµè®¾ç½®
                    </button>
                    <button class="btn btn-secondary" onclick="testWorkflowSettings()">
                        <i class="fa-solid fa-vial"></i> æµ‹è¯•å·¥ä½œæµè®¾ç½®
                    </button>
                </div>

                <div class="test-card">
                    <h3>å·¥ä½œæµé…ç½®</h3>
                    <p>æµ‹è¯•å·¥ä½œæµé…ç½®çš„ä¿å­˜å’ŒåŠ è½½</p>
                    <button class="btn btn-primary" onclick="testWorkflowConfig()">
                        <i class="fa-solid fa-cog"></i> æµ‹è¯•é…ç½®
                    </button>
                    <button class="btn btn-secondary" onclick="clearWorkflowConfig()">
                        <i class="fa-solid fa-trash"></i> æ¸…é™¤é…ç½®
                    </button>
                </div>
            </div>

            <div id="workflow-result" class="result-area" style="display: none;"></div>
        </div>

        <!-- LLMè®¾ç½®æµ‹è¯• -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-brain"></i>
                LLMè®¾ç½®æµ‹è¯•
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>LLMè®¾ç½®é¡µé¢</h3>
                    <p>æµ‹è¯•LLMè®¾ç½®é¡µé¢çš„åŠŸèƒ½</p>
                    <button class="btn btn-primary" onclick="openLLMSettings()">
                        <i class="fa-solid fa-external-link-alt"></i> æ‰“å¼€LLMè®¾ç½®
                    </button>
                    <button class="btn btn-secondary" onclick="testLLMSettings()">
                        <i class="fa-solid fa-vial"></i> æµ‹è¯•LLMè®¾ç½®
                    </button>
                </div>

                <div class="test-card">
                    <h3>LLMé…ç½®</h3>
                    <p>æµ‹è¯•LLMé…ç½®çš„ä¿å­˜å’ŒåŠ è½½</p>
                    <button class="btn btn-primary" onclick="testLLMConfig()">
                        <i class="fa-solid fa-cog"></i> æµ‹è¯•é…ç½®
                    </button>
                    <button class="btn btn-secondary" onclick="clearLLMConfig()">
                        <i class="fa-solid fa-trash"></i> æ¸…é™¤é…ç½®
                    </button>
                </div>
            </div>

            <div id="llm-result" class="result-area" style="display: none;"></div>
        </div>

        <!-- è®¾ç½®åŒæ­¥æµ‹è¯• -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-sync"></i>
                è®¾ç½®åŒæ­¥æµ‹è¯•
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>æ¶ˆæ¯ä¼ é€’</h3>
                    <p>æµ‹è¯•è®¾ç½®é¡µé¢ä¸å·¥å…·ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’</p>
                    <button class="btn btn-primary" onclick="testMessagePassing()">
                        <i class="fa-solid fa-comment"></i> æµ‹è¯•æ¶ˆæ¯ä¼ é€’
                    </button>
                    <button class="btn btn-secondary" onclick="simulateSettingsUpdate()">
                        <i class="fa-solid fa-bell"></i> æ¨¡æ‹Ÿè®¾ç½®æ›´æ–°
                    </button>
                </div>

                <div class="test-card">
                    <h3>è®¾ç½®çŠ¶æ€</h3>
                    <p>æŸ¥çœ‹å½“å‰æ‰€æœ‰è®¾ç½®çš„çŠ¶æ€</p>
                    <button class="btn btn-primary" onclick="showSettingsStatus()">
                        <i class="fa-solid fa-info-circle"></i> æ˜¾ç¤ºçŠ¶æ€
                    </button>
                    <button class="btn btn-secondary" onclick="exportSettings()">
                        <i class="fa-solid fa-download"></i> å¯¼å‡ºè®¾ç½®
                    </button>
                </div>
            </div>

            <div id="sync-result" class="result-area" style="display: none;"></div>
        </div>

        <!-- å·¥å…·é›†æˆæµ‹è¯• -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fa-solid fa-tools"></i>
                å·¥å…·é›†æˆæµ‹è¯•
            </h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>å·¥å…·é¡µé¢</h3>
                    <p>æµ‹è¯•å„ä¸ªå·¥å…·é¡µé¢çš„è®¾ç½®é›†æˆ</p>
                    <button class="btn btn-primary" onclick="openContractParse()">
                        <i class="fa-solid fa-file-contract"></i> åˆåŒè§£æ
                    </button>
                    <button class="btn btn-primary" onclick="openContractReview()">
                        <i class="fa-solid fa-search"></i> åˆåŒå®¡æ ¸
                    </button>
                    <button class="btn btn-primary" onclick="openDocumentGen()">
                        <i class="fa-solid fa-file-alt"></i> åˆåŒç”Ÿæˆ
                    </button>
                </div>

                <div class="test-card">
                    <h3>è®¾ç½®ç›‘å¬</h3>
                    <p>æµ‹è¯•å·¥å…·å¯¹è®¾ç½®æ›´æ–°çš„ç›‘å¬</p>
                    <button class="btn btn-primary" onclick="testSettingsListener()">
                        <i class="fa-solid fa-ear"></i> æµ‹è¯•ç›‘å¬å™¨
                    </button>
                    <button class="btn btn-secondary" onclick="clearSettingsListener()">
                        <i class="fa-solid fa-times"></i> æ¸…é™¤ç›‘å¬å™¨
                    </button>
                </div>
            </div>

            <div id="tools-result" class="result-area" style="display: none;"></div>
        </div>
    </div>

    <script>
        // æµ‹è¯•å‡½æ•°
        function openWorkflowSettings() {
            window.open('tools/workflow-settings.html', '_blank');
            showResult('workflow-result', 'âœ… å·¥ä½œæµè®¾ç½®é¡µé¢å·²æ‰“å¼€');
        }

        function openLLMSettings() {
            window.open('tools/llm-settings.html', '_blank');
            showResult('llm-result', 'âœ… LLMè®¾ç½®é¡µé¢å·²æ‰“å¼€');
        }

        function testWorkflowSettings() {
            const result = {
                cozeOnlineApiKey: localStorage.getItem('coze_online_api_key') || 'æœªè®¾ç½®',
                cozeLocalUrl: localStorage.getItem('coze_local_base_url') || 'æœªè®¾ç½®',
                reviewWorkflowId: localStorage.getItem('coze_online_review_workflow_id') || 'æœªè®¾ç½®',
                parseWorkflowId: localStorage.getItem('coze_online_parse_workflow_id') || 'æœªè®¾ç½®'
            };
            
            showResult('workflow-result', `ğŸ“Š å·¥ä½œæµè®¾ç½®çŠ¶æ€:\n${JSON.stringify(result, null, 2)}`);
        }

        function testLLMSettings() {
            const result = {
                googleApiKey: localStorage.getItem('google_api_key') ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®',
                deepseekApiKey: localStorage.getItem('deepseek_api_key') ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®',
                cozeApiKey: localStorage.getItem('coze_api_key') ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®',
                aiChatModel: localStorage.getItem('ai-chat_model') || 'æœªè®¾ç½®',
                documentGenModel: localStorage.getItem('document-gen_model') || 'æœªè®¾ç½®',
                homepageModel: localStorage.getItem('homepage_model') || 'æœªè®¾ç½®'
            };
            
            showResult('llm-result', `ğŸ“Š LLMè®¾ç½®çŠ¶æ€:\n${JSON.stringify(result, null, 2)}`);
        }

        function testWorkflowConfig() {
            // æ¨¡æ‹Ÿè®¾ç½®ä¸€äº›å·¥ä½œæµé…ç½®
            localStorage.setItem('coze_online_api_key', 'test-coze-api-key');
            localStorage.setItem('coze_local_base_url', 'http://localhost:8080');
            localStorage.setItem('coze_online_review_workflow_id', 'test-review-workflow');
            localStorage.setItem('coze_online_parse_workflow_id', 'test-parse-workflow');
            
            showResult('workflow-result', 'âœ… å·¥ä½œæµé…ç½®å·²è®¾ç½®æµ‹è¯•æ•°æ®');
        }

        function testLLMConfig() {
            // æ¨¡æ‹Ÿè®¾ç½®ä¸€äº›LLMé…ç½®
            localStorage.setItem('google_api_key', 'test-google-api-key');
            localStorage.setItem('deepseek_api_key', 'test-deepseek-api-key');
            localStorage.setItem('ai-chat_model', 'gemini-2.5-pro');
            localStorage.setItem('document-gen_model', 'deepseek-chat');
            
            showResult('llm-result', 'âœ… LLMé…ç½®å·²è®¾ç½®æµ‹è¯•æ•°æ®');
        }

        function clearWorkflowConfig() {
            localStorage.removeItem('coze_online_api_key');
            localStorage.removeItem('coze_local_base_url');
            localStorage.removeItem('coze_online_review_workflow_id');
            localStorage.removeItem('coze_online_parse_workflow_id');
            
            showResult('workflow-result', 'ğŸ—‘ï¸ å·¥ä½œæµé…ç½®å·²æ¸…é™¤');
        }

        function clearLLMConfig() {
            localStorage.removeItem('google_api_key');
            localStorage.removeItem('deepseek_api_key');
            localStorage.removeItem('coze_api_key');
            localStorage.removeItem('ai-chat_model');
            localStorage.removeItem('document-gen_model');
            localStorage.removeItem('homepage_model');
            
            showResult('llm-result', 'ğŸ—‘ï¸ LLMé…ç½®å·²æ¸…é™¤');
        }

        function testMessagePassing() {
            // æ¨¡æ‹Ÿå‘é€è®¾ç½®æ›´æ–°æ¶ˆæ¯
            const testMessage = {
                type: 'workflow_settings_updated',
                data: {
                    cozeOnline: {
                        apiKey: 'test-api-key',
                        reviewWorkflowId: 'test-workflow-id'
                    }
                }
            };
            
            window.postMessage(testMessage, '*');
            showResult('sync-result', 'âœ… æµ‹è¯•æ¶ˆæ¯å·²å‘é€');
        }

        function simulateSettingsUpdate() {
            // æ¨¡æ‹Ÿè®¾ç½®æ›´æ–°
            const testMessage = {
                type: 'llm_settings_updated',
                data: {
                    apiKeys: {
                        google: 'test-google-key',
                        deepseek: 'test-deepseek-key'
                    },
                    toolModels: {
                        aiChat: 'gemini-2.5-pro',
                        documentGen: 'deepseek-chat'
                    }
                }
            };
            
            window.postMessage(testMessage, '*');
            showResult('sync-result', 'âœ… è®¾ç½®æ›´æ–°æ¶ˆæ¯å·²å‘é€');
        }

        function showSettingsStatus() {
            const status = {
                workflowSettings: {
                    cozeOnline: localStorage.getItem('coze_online_api_key') ? 'å·²é…ç½®' : 'æœªé…ç½®',
                    cozeLocal: localStorage.getItem('coze_local_base_url') ? 'å·²é…ç½®' : 'æœªé…ç½®'
                },
                llmSettings: {
                    google: localStorage.getItem('google_api_key') ? 'å·²é…ç½®' : 'æœªé…ç½®',
                    deepseek: localStorage.getItem('deepseek_api_key') ? 'å·²é…ç½®' : 'æœªé…ç½®',
                    coze: localStorage.getItem('coze_api_key') ? 'å·²é…ç½®' : 'æœªé…ç½®'
                },
                toolModels: {
                    aiChat: localStorage.getItem('ai-chat_model') || 'æœªè®¾ç½®',
                    documentGen: localStorage.getItem('document-gen_model') || 'æœªè®¾ç½®',
                    homepage: localStorage.getItem('homepage_model') || 'æœªè®¾ç½®'
                }
            };
            
            showResult('sync-result', `ğŸ“Š è®¾ç½®çŠ¶æ€:\n${JSON.stringify(status, null, 2)}`);
        }

        function exportSettings() {
            const settings = {
                workflow: {
                    cozeOnlineApiKey: localStorage.getItem('coze_online_api_key'),
                    cozeLocalUrl: localStorage.getItem('coze_local_base_url'),
                    reviewWorkflowId: localStorage.getItem('coze_online_review_workflow_id'),
                    parseWorkflowId: localStorage.getItem('coze_online_parse_workflow_id')
                },
                llm: {
                    googleApiKey: localStorage.getItem('google_api_key'),
                    deepseekApiKey: localStorage.getItem('deepseek_api_key'),
                    cozeApiKey: localStorage.getItem('coze_api_key'),
                    aiChatModel: localStorage.getItem('ai-chat_model'),
                    documentGenModel: localStorage.getItem('document-gen_model'),
                    homepageModel: localStorage.getItem('homepage_model')
                }
            };
            
            const dataStr = JSON.stringify(settings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'settings-export.json';
            link.click();
            URL.revokeObjectURL(url);
            
            showResult('sync-result', 'ğŸ’¾ è®¾ç½®å·²å¯¼å‡ºåˆ° settings-export.json');
        }

        function openContractParse() {
            window.open('tools/contract-parse.html', '_blank');
        }

        function openContractReview() {
            window.open('tools/contract-review.html', '_blank');
        }

        function openDocumentGen() {
            window.open('tools/document-gen.html', '_blank');
        }

        function testSettingsListener() {
            // æ·»åŠ æ¶ˆæ¯ç›‘å¬å™¨
            window.addEventListener('message', function(event) {
                console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
                showResult('tools-result', `ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: ${JSON.stringify(event.data, null, 2)}`);
            });
            
            showResult('tools-result', 'âœ… è®¾ç½®ç›‘å¬å™¨å·²å¯åŠ¨ï¼Œè¯·åœ¨å…¶ä»–é¡µé¢å‘é€æ¶ˆæ¯è¿›è¡Œæµ‹è¯•');
        }

        function clearSettingsListener() {
            // æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯ç›‘å¬å™¨
            window.removeEventListener('message', arguments.callee);
            showResult('tools-result', 'ğŸ—‘ï¸ è®¾ç½®ç›‘å¬å™¨å·²æ¸…é™¤');
        }

        function showResult(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è®¾ç½®ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // ç›‘å¬è®¾ç½®æ›´æ–°æ¶ˆæ¯
            window.addEventListener('message', function(event) {
                if (event.data && (event.data.type === 'workflow_settings_updated' || event.data.type === 'llm_settings_updated')) {
                    console.log('æµ‹è¯•é¡µé¢æ”¶åˆ°è®¾ç½®æ›´æ–°æ¶ˆæ¯:', event.data);
                    showResult('sync-result', `ğŸ“¨ æ”¶åˆ°è®¾ç½®æ›´æ–°: ${event.data.type}`);
                }
            });
        });
    </script>
</body>
</html> 